
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scenario Analysis: Pop Up Shop &#8212; Companion Notebooks for Mathematical Optimization</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Chapter 2" href="../02/Chapter02.html" />
    <link rel="prev" title="Data Science Essentials: Applied Optimization" href="DSE_5_1_2021_Alice%27s_rose.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion Notebooks for Mathematical Optimization</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Companion Notebooks for Mathematical Optimization
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Chapter01.html">
   Chapter 1
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="DSE_5_1_2021_Alice%27s_rose.html">
     Data Science Essentials: Applied Optimization
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Scenario Analysis: Pop Up Shop
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/Chapter02.html">
   Chapter 2
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/EF_RO.html">
     Companion notebook to EF’s training on optimization with data uncertainty
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03/Chapter03.html">
   Chapter 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04/Chapter04.html">
   Chapter 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05/Chapter05.html">
   Chapter 5
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06/Chapter06.html">
   Chapter 6
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07/Chapter07.html">
   Chapter 7
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../08/Chapter08.html">
   Chapter 8
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../09/Chapter09.html">
   Chapter 11
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10/Chapter10.html">
   Chapter 10
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../11/Chapter11.html">
   Chapter 11
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/01/Pop-Up-Shop.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/jckantor/MO-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/jckantor/MO-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/01/Pop-Up-Shop.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/jckantor/MO-book/main?urlpath=tree/notebooks/01/Pop-Up-Shop.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/jckantor/MO-book/blob/main/notebooks/01/Pop-Up-Shop.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-problem">
   The Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-model-to-maximize-expected-profit">
   A Model to Maximize Expected Profit
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coding-the-model-in-pyomo">
   Coding the Model in Pyomo
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solution">
   Solution
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-value-for-the-mean-scenario-evm">
     Expected Value for the Mean Scenario (EVM)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-value-with-perfect-information-evpi">
     Expected Value with Perfect Information (EVPI)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-value-by-stochastic-programming">
     Expected Value by Stochastic Programming
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#value-of-perfect-information">
     Value of Perfect Information
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#value-of-the-stochastic-solution">
     Value of the Stochastic Solution
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Scenario Analysis: Pop Up Shop</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-problem">
   The Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-model-to-maximize-expected-profit">
   A Model to Maximize Expected Profit
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coding-the-model-in-pyomo">
   Coding the Model in Pyomo
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solution">
   Solution
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-value-for-the-mean-scenario-evm">
     Expected Value for the Mean Scenario (EVM)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-value-with-perfect-information-evpi">
     Expected Value with Perfect Information (EVPI)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-value-by-stochastic-programming">
     Expected Value by Stochastic Programming
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#value-of-perfect-information">
     Value of Perfect Information
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#value-of-the-stochastic-solution">
     Value of the Stochastic Solution
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="scenario-analysis-pop-up-shop">
<h1>Scenario Analysis: Pop Up Shop<a class="headerlink" href="#scenario-analysis-pop-up-shop" title="Permalink to this headline">¶</a></h1>
<div class="margin sidebar">
<p class="sidebar-title">Under Development</p>
<p>This notebook is being developed based on older GLPK example.</p>
</div>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Weich_Couture_Alpaca%2C_D%C3%BCsseldorf%2C_December_2020_%2809%29.jpg/1200px-Weich_Couture_Alpaca%2C_D%C3%BCsseldorf%2C_December_2020_%2809%29.jpg" /></p>
<p>Kürschner (talk) 17:51, 1 December 2020 (UTC), CC0, via Wikimedia Commons</p>
<div class="section" id="the-problem">
<h2>The Problem<a class="headerlink" href="#the-problem" title="Permalink to this headline">¶</a></h2>
<p>You’ve been offered an opportunity to operate a pop-up shop for events occuring at a famous location. For each event you’ll be selling an item unique item. The items you would be selling costs €5 each and you will be able to sell them for 20€. But if they don’t sell during the event then you will receive only 2 for each item returned to the supplier.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Parameter</p></th>
<th class="text-align:center head"><p>Symbol</p></th>
<th class="text-align:center head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>sales price</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(r\)</span></p></td>
<td class="text-align:center"><p>€20</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>unit cost</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(c\)</span></p></td>
<td class="text-align:center"><p>€5</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>salvage value</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(w\)</span></p></td>
<td class="text-align:center"><p>€2</p></td>
</tr>
</tbody>
</table>
<p>It is clear the more you sell the more profit you will earn. Demand for these items, however, will be high only if the weather is good. Historical data suggests typical scenarios.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Scenario (<span class="math notranslate nohighlight">\(s\)</span>)</p></th>
<th class="text-align:center head"><p>Demand (<span class="math notranslate nohighlight">\(D_s\)</span>)</p></th>
<th class="text-align:center head"><p>Probability (<span class="math notranslate nohighlight">\(p_s\)</span>)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Sunny Skies</p></td>
<td class="text-align:center"><p>500</p></td>
<td class="text-align:center"><p>0.25</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Good Weather</p></td>
<td class="text-align:center"><p>400</p></td>
<td class="text-align:center"><p>0.50</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Poor Weather</p></td>
<td class="text-align:center"><p>200</p></td>
<td class="text-align:center"><p>0.25</p></td>
</tr>
</tbody>
</table>
<p>The ordering dilemma, of course, is that the weather won’t be known until after the order is placed. Order enough items to meet demand for a good weather day results in a  financial penalty on returned goods if the weather is poor. But ordering just enough to satisfy the demand on a poor weather day leaves “money on the table” for good weather days.</p>
<p>What choice would you make?</p>
<p>One possibility to order enough to meet expected demand. The expected demand is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\mathbb E[D] &amp; = \sum_{s} p_s D_s \\
&amp; = 0.25\times 500 + 0.5\times 400 + 0.25\times 200 \\
&amp; = 375
\end{align*}
\end{split}\]</div>
<p>A spreadsheet analysis shows an average profit of €5,052 and no scenario shows a loss. This would appear to be a satisfactory outcome.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Scenario (<span class="math notranslate nohighlight">\(s\)</span>)</p></th>
<th class="text-align:center head"><p>Demand (<span class="math notranslate nohighlight">\(D_s\)</span>)</p></th>
<th class="text-align:center head"><p>Probability (<span class="math notranslate nohighlight">\(p_s\)</span>)</p></th>
<th class="text-align:center head"><p>Ordered (<span class="math notranslate nohighlight">\(x\)</span>)</p></th>
<th class="text-align:center head"><p>Sold (<span class="math notranslate nohighlight">\(y_s\)</span>)</p></th>
<th class="text-align:center head"><p>Salvage (<span class="math notranslate nohighlight">\(x - y_s\)</span>)</p></th>
<th class="text-align:center head"><p>Profit (<span class="math notranslate nohighlight">\(f_s\)</span>)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Sunny Skies</p></td>
<td class="text-align:center"><p>500</p></td>
<td class="text-align:center"><p>0.30</p></td>
<td class="text-align:center"><p>380</p></td>
<td class="text-align:center"><p>380</p></td>
<td class="text-align:center"><p>0</p></td>
<td class="text-align:center"><p>€5,700</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Good Weather</p></td>
<td class="text-align:center"><p>350</p></td>
<td class="text-align:center"><p>0.60</p></td>
<td class="text-align:center"><p>380</p></td>
<td class="text-align:center"><p>350</p></td>
<td class="text-align:center"><p>30</p></td>
<td class="text-align:center"><p>€5,160</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Poor Weather</p></td>
<td class="text-align:center"><p>200</p></td>
<td class="text-align:center"><p>0.10</p></td>
<td class="text-align:center"><p>380</p></td>
<td class="text-align:center"><p>200</p></td>
<td class="text-align:center"><p>175</p></td>
<td class="text-align:center"><p>€2,460</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><strong>Average</strong></p></td>
<td class="text-align:center"><p><strong>375</strong></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>€5,052</strong></p></td>
</tr>
</tbody>
</table>
<p>Can we find an order resulting in a higher expected profit?</p>
</div>
<div class="section" id="a-model-to-maximize-expected-profit">
<h2>A Model to Maximize Expected Profit<a class="headerlink" href="#a-model-to-maximize-expected-profit" title="Permalink to this headline">¶</a></h2>
<p>Given the variables defined in the table above, the profit <span class="math notranslate nohighlight">\(f_s\)</span> for scenario <span class="math notranslate nohighlight">\(s\)</span> is</p>
<div class="math notranslate nohighlight">
\[f_s = \underbrace{r y_s}_\text{sales revenue} + \underbrace{w (D_s - y_s)}_\text{salvage value} - \underbrace{c x}_\text{order cost}\]</div>
<p>The expected profit <span class="math notranslate nohighlight">\(\mathbb E[f]\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
\mathbb E[f] &amp; = \sum_s p_s f_s
\end{align*}
\]</div>
<p>Operationally, <span class="math notranslate nohighlight">\(y_s\)</span> can be no larger the number of items ordered, <span class="math notranslate nohighlight">\(x\)</span>, or the demand under scenario <span class="math notranslate nohighlight">\(s\)</span>, <span class="math notranslate nohighlight">\(D_s\)</span>. Putting this together, the problem to be solved is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
&amp; \max_{x, y_s} \mathbb E[f] = \sum_{s\in S} p_s f_s \\
\text{subject to} \\
f_s &amp; = r y_s + w(D_s - y_s) - c x &amp; \forall s \in S\\
y_s &amp; \leq x &amp; \forall s \in S \\
y_s &amp; \leq D_s &amp; \forall s \in S
\end{align*}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(x\)</span> is a non-negative number representing the number of items that will be ordered, and the non-negative variable <span class="math notranslate nohighlight">\(y_s\)</span> refers the number of items sold in scenario <span class="math notranslate nohighlight">\(s\)</span> in the set <span class="math notranslate nohighlight">\(S\)</span> comprising all scenarios under consideration.</p>
</div>
<div class="section" id="coding-the-model-in-pyomo">
<h2>Coding the Model in Pyomo<a class="headerlink" href="#coding-the-model-in-pyomo" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">at_colab</span> <span class="o">=</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span>

<span class="k">if</span> <span class="n">at_colab</span><span class="p">:</span>
    <span class="n">_</span><span class="o">=!</span>pip install -q pyomo
    <span class="n">_</span><span class="o">=!</span>wget -N -q <span class="s2">&quot;https://ampl.com/dl/open/ipopt/ipopt-linux64.zip&quot;</span>
    <span class="n">_</span><span class="o">=!</span>unzip -o -q ipopt-linux64
    <span class="n">_</span><span class="o">=!</span>apt-get install -y -q coinor-cbc
    <span class="n">_</span><span class="o">=!</span>pip install -q cplex
    <span class="n">_</span><span class="o">=!</span>pip install -q gurobipy
    <span class="n">_</span><span class="o">=!</span>pip install -q xpress
</pre></div>
</div>
</div>
</div>
<p>We begin by encoding the problem data using standard Python objects. The scenario information is stored as nested dictionary … a commonly used technique in Python to store structured data. Here each scenario is represented by a descriptive key. In turn, the value of each scenario is a dictionary with keys labeling the demand and probability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># price information</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">w</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># scenario information</span>
<span class="n">scenarios</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;sunny skies&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">},</span>
    <span class="s2">&quot;good weather&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="mi">350</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">},</span>
    <span class="s2">&quot;poor weather&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>

<span class="c1"># create model instance</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="s1">&#39;Pop-up Shop&#39;</span><span class="p">)</span>

<span class="c1"># decision variables</span>
<span class="n">pm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
<span class="n">pm</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">scenarios</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
<span class="n">pm</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">scenarios</span><span class="p">)</span>

<span class="c1"># objective</span>
<span class="n">pm</span><span class="o">.</span><span class="n">expected_profit</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">scenarios</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">pm</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">keys</span><span class="p">()]),</span> 
                                   <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>

<span class="c1"># constraints</span>
<span class="n">pm</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConstraintList</span><span class="p">()</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span><span class="o">*</span><span class="n">pm</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">scenarios</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s2">&quot;demand&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pm</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">pm</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pm</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">scenarios</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>

<span class="n">pm</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3 Set Declarations
    constraints_index : Size=1, Index=None, Ordered=Insertion
        Key  : Dimen : Domain : Size : Members
        None :     1 :    Any :    9 : {1, 2, 3, 4, 5, 6, 7, 8, 9}
    f_index : Size=1, Index=None, Ordered=False
        Key  : Dimen : Domain : Size : Members
        None :     1 :    Any :    3 : {&#39;good weather&#39;, &#39;poor weather&#39;, &#39;sunny skies&#39;}
    y_index : Size=1, Index=None, Ordered=False
        Key  : Dimen : Domain : Size : Members
        None :     1 :    Any :    3 : {&#39;good weather&#39;, &#39;poor weather&#39;, &#39;sunny skies&#39;}

3 Var Declarations
    f : Size=3, Index=f_index
        Key          : Lower : Value : Upper : Fixed : Stale : Domain
        good weather :  None :  None :  None : False :  True :  Reals
        poor weather :  None :  None :  None : False :  True :  Reals
         sunny skies :  None :  None :  None : False :  True :  Reals
    x : Size=1, Index=None
        Key  : Lower : Value : Upper : Fixed : Stale : Domain
        None :     0 :  None :  None : False :  True : NonNegativeReals
    y : Size=3, Index=y_index
        Key          : Lower : Value : Upper : Fixed : Stale : Domain
        good weather :     0 :  None :  None : False :  True : NonNegativeReals
        poor weather :     0 :  None :  None : False :  True : NonNegativeReals
         sunny skies :     0 :  None :  None : False :  True : NonNegativeReals

1 Objective Declarations
    expected_profit : Size=1, Index=None, Active=True
        Key  : Active : Sense    : Expression
        None :   True : maximize : 0.3*f[sunny skies] + 0.6*f[good weather] + 0.1*f[poor weather]

1 Constraint Declarations
    constraints : Size=9, Index=constraints_index, Active=True
        Key : Lower : Body                                                                      : Upper : Active
          1 :   0.0 :    f[sunny skies] - (20*y[sunny skies] + 2*(500 - y[sunny skies]) - 12*x) :   0.0 :   True
          2 :  -Inf :                                                        y[sunny skies] - x :   0.0 :   True
          3 :  -Inf :                                                            y[sunny skies] : 500.0 :   True
          4 :   0.0 : f[good weather] - (20*y[good weather] + 2*(350 - y[good weather]) - 12*x) :   0.0 :   True
          5 :  -Inf :                                                       y[good weather] - x :   0.0 :   True
          6 :  -Inf :                                                           y[good weather] : 350.0 :   True
          7 :   0.0 : f[poor weather] - (20*y[poor weather] + 2*(200 - y[poor weather]) - 12*x) :   0.0 :   True
          8 :  -Inf :                                                       y[poor weather] - x :   0.0 :   True
          9 :  -Inf :                                                           y[poor weather] : 200.0 :   True

8 Declarations: x y_index y f_index f expected_profit constraints_index constraints
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_demand</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">scenarios</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">scenarios</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s2">&quot;demand&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected Demand = </span><span class="si">{</span><span class="n">expected_demand</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Order size = </span><span class="si">{</span><span class="n">pm</span><span class="o">.</span><span class="n">x</span><span class="p">()</span><span class="si">:</span><span class="s2">0.1f</span><span class="si">}</span><span class="s2"> units&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected Profit = </span><span class="si">{</span><span class="n">pm</span><span class="o">.</span><span class="n">expected_profit</span><span class="p">()</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scenario      Probabilty  Demand  Order  Sales Salvage   Profit&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">scenarios</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">scenarios</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;demand&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">12s</span><span class="si">}</span><span class="s2">        </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">     </span><span class="si">{</span><span class="n">pm</span><span class="o">.</span><span class="n">x</span><span class="p">()</span><span class="si">:</span><span class="s2">3.0f</span><span class="si">}</span><span class="s2">    </span><span class="si">{</span><span class="n">D</span><span class="si">:</span><span class="s2">3.0f</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pm</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">s</span><span class="p">]()</span><span class="si">:</span><span class="s2">5.0f</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">D</span> <span class="o">-</span> <span class="n">pm</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">s</span><span class="p">]()</span><span class="si">:</span><span class="s2">5.0f</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pm</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]()</span><span class="si">:</span><span class="s2">5.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Demand = 380.0
Order size = 350.0 units
Expected Profit = 2590.00

Scenario      Probabilty  Demand  Order  Sales Salvage   Profit
sunny skies         0.30     350    500    350     150  3100.00
good weather        0.60     350    350    350       0  2800.00
poor weather        0.10     350    200    200       0  -200.00
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">popup</span><span class="o">.</span><span class="n">expected_profit</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">popup</span><span class="o">.</span><span class="n">x</span><span class="p">())</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">popup</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">s</span><span class="p">]())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">cm</span><span class="o">/</span><span class="n">z3t28j296f98jdp1vqyplkz00000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_26043</span><span class="o">/</span><span class="mf">2430676036.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">popup</span><span class="o">.</span><span class="n">expected_profit</span><span class="p">())</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">popup</span><span class="o">.</span><span class="n">x</span><span class="p">())</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="nb">print</span><span class="p">(</span><span class="n">popup</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">s</span><span class="p">]())</span>

<span class="ne">NameError</span>: name &#39;popup&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="c1"># expected demand</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected Demand = </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">0.1f</span><span class="si">}</span><span class="s2"> units</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">s</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">s</span><span class="p">[</span><span class="s2">&quot;profit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span>  <span class="n">c</span><span class="o">*</span><span class="n">x</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> profit = </span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;profit&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
<span class="n">expected_profit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;profit&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Expected Profit = </span><span class="si">{</span><span class="n">expected_profit</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Demand = 380.0 units

sunny skies profit = 3040.00
good weather profit = 2500.00
poor weather profit = -200.00

Expected Profit = 2392.00
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">script</span> glpsol -m /dev/stdin

# Example: Newsvendor.mod

/* Unit Price Data */
param r &gt;= 0;                              # Price
param c &gt;= 0;                              # Cost
param w &gt;= 0;                              # Salvage value

/* Price data makes sense only if  Price &gt; Cost &gt; Salvage */
check: c &lt;= r;
check: w &lt;= c;

/* Probabilistic Demand Forecast */
set SCENS;                                 # Scenarios
param D{SCENS} &gt;= 0;                       # Demand
param Pr{SCENS} &gt;= 0;                      # Probability

/* Probabilities must sum to one. */
check: sum{k in SCENS} Pr[k] = 1;

/* Expected Demand */
param ExD := sum{k in SCENS} Pr[k]*D[k];

/* Lower Bound on Profit: Expected Value of the Mean Solution */
param EVM := -c*ExD + sum{k in SCENS} Pr[k]*(r*min(ExD,D[k])+w*max(ExD-D[k],0));

/* Upper Bound on Profit: Expected Value with Perfect Information */
param EVPI := sum{k in SCENS} Pr[k]*(r-c)*D[k];

/* Two Stage Stochastic Programming */
var x &gt;= 0;                     # Stage 1 (Here and Now): Order Quqntity
var y{SCENS}&gt;= 0;               # Stage 2 (Scenario Dep): Actual Sales
var ExProfit;                   # Expected Profit

/* Maximize Expected Profit */
maximize OBJ: ExProfit;

/* Goods sold are limited by the order quantities and the demand  */
s.t. PRFT: ExProfit = -c*x + sum{k in SCENS} Pr[k]*(r*y[k] + w*(x-y[k]));
s.t. SUPL {k in SCENS}: y[k] &lt;= x;
s.t. DMND {k in SCENS}: y[k] &lt;= D[k];

solve;

table Table_EVM {k in SCENS} OUT &quot;CSV&quot; &quot;evm.csv&quot; &quot;Table&quot;:
   k~Scenario,
   Pr[k]~Probability, 
   D[k]~Demand, 
   ExD~Order, 
   min(ExD,D[k])~Sold,
   max(ExD-D[k],0)~Salvage, 
   -c*ExD + r*min(ExD,D[k]) + w*max(ExD-D[k],0)~Profit;
   
table Table_EVPI {k in SCENS} OUT &quot;CSV&quot; &quot;evpi.csv&quot; &quot;Table&quot;:
   k~Scenario,
   Pr[k]~Probability, 
   D[k]~Demand, 
   D[k]~Order, 
   D[k]~Sold,
   0~Salvage, 
   -c*D[k] + r*D[k]~Profit;
   
table Table_SP {k in SCENS} OUT &quot;CSV&quot; &quot;evsp.csv&quot; &quot;Table&quot;:
   k~Scenario,
   Pr[k]~Probability, 
   D[k]~Demand, 
   x~Order, 
   y[k]~Sold,
   x-y[k]~Salvage, 
   -c*x + r*y[k] + w*(x-y[k])~Profit;

data;

/* Problem Data corresponds to a hypothetical case of selling programs prior 
to a home football game. */

param r := 10.00;                         # Unit Price
param c :=  6.00;                         # Unit Cost
param w :=  2.00;                         # Unit Salvage Value

param: SCENS:  Pr    D   :=
       HiDmd   0.25  250
       MiDmd   0.50  125
       LoDmd   0.25   75 ;

end;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GLPSOL: GLPK LP/MIP Solver, v4.52
Parameter(s) specified in the command line:
 -m /dev/stdin
Reading model section from /dev/stdin...
Reading data section from /dev/stdin...
/dev/stdin:86: warning: final NL missing before end of file
86 lines were read
Checking (line 10)...
Checking (line 11)...
Checking (line 19)...
Generating OBJ...
Generating PRFT...
Generating SUPL...
Generating DMND...
Model has been successfully generated
GLPK Simplex Optimizer, v4.52
8 rows, 5 columns, 15 non-zeros
Preprocessing...
3 rows, 4 columns, 6 non-zeros
Scaling...
 A: min|aij| =  1.000e+00  max|aij| =  1.000e+00  ratio =  1.000e+00
Problem data seem to be well scaled
Constructing initial basis...
Size of triangular part is 3
*     0: obj =   0.000000000e+00  infeas =  0.000e+00 (0)
*     5: obj =   4.000000000e+02  infeas =  0.000e+00 (0)
OPTIMAL LP SOLUTION FOUND
Time used:   0.0 secs
Memory used: 0.1 Mb (142439 bytes)
Writing Table_EVM...
Writing Table_EVPI...
Writing Table_SP...
Model has been successfully processed
</pre></div>
</div>
</div>
</div>
<div class="section" id="expected-value-for-the-mean-scenario-evm">
<h3>Expected Value for the Mean Scenario (EVM)<a class="headerlink" href="#expected-value-for-the-mean-scenario-evm" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="n">evm</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;evm.csv&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">evm</span><span class="p">)</span>

<span class="n">ev_evm</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">evm</span><span class="p">[</span><span class="s1">&#39;Probability&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">evm</span><span class="p">[</span><span class="s1">&#39;Profit&#39;</span><span class="p">])</span>
<span class="nb">print</span> <span class="s2">&quot;Expected Value for the Mean Scenario = </span><span class="si">{:6.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ev_evm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scenario</th>
      <th>Probability</th>
      <th>Demand</th>
      <th>Order</th>
      <th>Sold</th>
      <th>Salvage</th>
      <th>Profit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> HiDmd</td>
      <td> 0.25</td>
      <td> 250</td>
      <td> 143.75</td>
      <td> 143.75</td>
      <td>  0.00</td>
      <td> 575</td>
    </tr>
    <tr>
      <th>1</th>
      <td> MiDmd</td>
      <td> 0.50</td>
      <td> 125</td>
      <td> 143.75</td>
      <td> 125.00</td>
      <td> 18.75</td>
      <td> 425</td>
    </tr>
    <tr>
      <th>2</th>
      <td> LoDmd</td>
      <td> 0.25</td>
      <td>  75</td>
      <td> 143.75</td>
      <td>  75.00</td>
      <td> 68.75</td>
      <td>  25</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 7 columns</p>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Value for the Mean Scenario = 362.50
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="expected-value-with-perfect-information-evpi">
<h3>Expected Value with Perfect Information (EVPI)<a class="headerlink" href="#expected-value-with-perfect-information-evpi" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evpi</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;evpi.csv&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">evpi</span><span class="p">)</span>

<span class="n">ev_evpi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">evpi</span><span class="p">[</span><span class="s1">&#39;Probability&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">evpi</span><span class="p">[</span><span class="s1">&#39;Profit&#39;</span><span class="p">])</span>
<span class="nb">print</span> <span class="s2">&quot;Expected Value with Perfect Information = </span><span class="si">{:6.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ev_evpi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scenario</th>
      <th>Probability</th>
      <th>Demand</th>
      <th>Order</th>
      <th>Sold</th>
      <th>Salvage</th>
      <th>Profit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> HiDmd</td>
      <td> 0.25</td>
      <td> 250</td>
      <td> 250</td>
      <td> 250</td>
      <td> 0</td>
      <td> 1000</td>
    </tr>
    <tr>
      <th>1</th>
      <td> MiDmd</td>
      <td> 0.50</td>
      <td> 125</td>
      <td> 125</td>
      <td> 125</td>
      <td> 0</td>
      <td>  500</td>
    </tr>
    <tr>
      <th>2</th>
      <td> LoDmd</td>
      <td> 0.25</td>
      <td>  75</td>
      <td>  75</td>
      <td>  75</td>
      <td> 0</td>
      <td>  300</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 7 columns</p>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Value with Perfect Information = 575.00
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="expected-value-by-stochastic-programming">
<h3>Expected Value by Stochastic Programming<a class="headerlink" href="#expected-value-by-stochastic-programming" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evsp</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;evsp.csv&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">evsp</span><span class="p">)</span>

<span class="n">ev_evsp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">evsp</span><span class="p">[</span><span class="s1">&#39;Probability&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">evsp</span><span class="p">[</span><span class="s1">&#39;Profit&#39;</span><span class="p">])</span>
<span class="nb">print</span> <span class="s2">&quot;Expected Value by Stochastic Programming = </span><span class="si">{:6.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ev_evsp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scenario</th>
      <th>Probability</th>
      <th>Demand</th>
      <th>Order</th>
      <th>Sold</th>
      <th>Salvage</th>
      <th>Profit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> HiDmd</td>
      <td> 0.25</td>
      <td> 250</td>
      <td> 125</td>
      <td> 125</td>
      <td>  0</td>
      <td> 500</td>
    </tr>
    <tr>
      <th>1</th>
      <td> MiDmd</td>
      <td> 0.50</td>
      <td> 125</td>
      <td> 125</td>
      <td> 125</td>
      <td>  0</td>
      <td> 500</td>
    </tr>
    <tr>
      <th>2</th>
      <td> LoDmd</td>
      <td> 0.25</td>
      <td>  75</td>
      <td> 125</td>
      <td>  75</td>
      <td> 50</td>
      <td> 100</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 7 columns</p>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected Value by Stochastic Programming = 400.00
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="value-of-perfect-information">
<h3>Value of Perfect Information<a class="headerlink" href="#value-of-perfect-information" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Value of Perfect Information = </span><span class="si">{:6.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ev_evpi</span><span class="o">-</span><span class="n">ev_evsp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Value of Perfect Information = 175.00
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="value-of-the-stochastic-solution">
<h3>Value of the Stochastic Solution<a class="headerlink" href="#value-of-the-stochastic-solution" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Value of the Stochastic Solution = </span><span class="si">{:6.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ev_evsp</span><span class="o">-</span><span class="n">ev_evm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Value of the Stochastic Solution =  37.50
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="mf">1.00</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">0.60</span>
<span class="n">w</span> <span class="o">=</span> <span class="mf">0.25</span>

<span class="k">def</span> <span class="nf">profit</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">*</span><span class="nb">min</span><span class="p">([</span><span class="n">D</span><span class="p">,</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="n">D</span><span class="p">])</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scenarios</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Low Demand&#39;</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mf">.25</span><span class="p">],[</span><span class="s1">&#39;High Demand&#39;</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mf">.75</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">exprofit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">+=</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">profit</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">profit</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">)</span>
<span class="n">exprofit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.profit&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">map</span><span class="p">(</span><span class="n">exprofit</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Order size&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Expected Profit&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.text.Text at 0x108b82790&gt;
</pre></div>
</div>
<img alt="../../_images/Pop-Up-Shop_29_1.png" src="../../_images/Pop-Up-Shop_29_1.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/01"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="DSE_5_1_2021_Alice%27s_rose.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Data Science Essentials: Applied Optimization</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../02/Chapter02.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 2</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By The MO Book group<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>